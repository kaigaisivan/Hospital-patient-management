{% extends 'base.html' %}

{% block title %}Emergency Contact{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row">
    <div class="col-md-8">
      <h2 class="fw-bold mb-4">
        <a href="{% url 'profile' %}" class="text-decoration-none text-muted me-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
          </svg>
        </a>
        Emergency Contact
      </h2>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}

      <div class="card mb-4">
        <div class="card-header bg-danger text-white">
          <h5 class="mb-0">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
              <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Zm.256 7a4 4 0 0 1-.5-8c1.536-2.6 7.864-2.6 9.4 0a4 4 0 0 1-.5 8c.106.164.294.648.294 1.043 0 .369-.266.636-.636.636-.38 0-.56-.306-.635-.799C13.995 15.937 12.904 16 8 16s-5.995-.063-6.279-.755c-.074.493-.256.799-.636.799-.37 0-.636-.267-.636-.636 0-.395.188-.879.294-1.043zM16 12.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0Z"/>
            </svg>
            Primary Emergency Contact
          </h5>
        </div>
        <div class="card-body">
          {% if profile.emergency_contact_name %}
            <div class="row mb-3">
              <div class="col-md-6">
                <strong>Name:</strong>
                <p>{{ profile.emergency_contact_name }}</p>
              </div>
              <div class="col-md-6">
                <strong>Relationship:</strong>
                <p>{{ profile.get_emergency_contact_relation_display }}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-md-6">
                <strong>Phone Number:</strong>
                <p>
                  <a href="tel:{{ profile.emergency_contact_phone }}" class="text-decoration-none">
                    {{ profile.emergency_contact_phone }}
                  </a>
                </p>
              </div>
            </div>
            <button class="btn btn-warning" data-bs-toggle="collapse" data-bs-target="#editContact">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                <path d="M12.146.145a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V12h2.293l6.5-6.5z"/>
                <path d="M16 12.5a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Zm-1.993-1.679a.5.5 0 0 0-.686.172l-1.335 2.226a.5.5 0 0 0 .428.728l.015.002a.5.5 0 0 0 .441-.26l1.335-2.226a.5.5 0 0 0-.172-.686Z"/>
              </svg>
              Edit Contact
            </button>
          {% else %}
            <p class="text-muted">No emergency contact information recorded.</p>
          {% endif %}
        </div>
      </div>

      <!-- Edit Emergency Contact Form (Collapsible) -->
      <div class="collapse" id="editContact">
        <div class="card card-body mb-4">
          <h6 class="fw-bold mb-3">Update Emergency Contact</h6>
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="edit_emergency" value="true">

            <div class="mb-3">
              <label for="emergency_name" class="form-label">Contact Name *</label>
              <input type="text" class="form-control" id="emergency_name" name="emergency_contact_name" 
                     value="{{ profile.emergency_contact_name|default:'' }}" required>
            </div>

            <div class="mb-3">
              <label for="emergency_phone" class="form-label">Contact Phone Number *</label>
              <input type="tel" class="form-control" id="emergency_phone" name="emergency_contact_phone" 
                     value="{{ profile.emergency_contact_phone|default:'' }}" required>
            </div>

            <div class="mb-3">
              <label for="emergency_relation" class="form-label">Relationship *</label>
              <select class="form-select" id="emergency_relation" name="emergency_contact_relation" required>
                <option value="">-- Select Relationship --</option>
                <option value="spouse" {% if profile.emergency_contact_relation == 'spouse' %}selected{% endif %}>Spouse</option>
                <option value="parent" {% if profile.emergency_contact_relation == 'parent' %}selected{% endif %}>Parent</option>
                <option value="child" {% if profile.emergency_contact_relation == 'child' %}selected{% endif %}>Child</option>
                <option value="sibling" {% if profile.emergency_contact_relation == 'sibling' %}selected{% endif %}>Sibling</option>
                <option value="relative" {% if profile.emergency_contact_relation == 'relative' %}selected{% endif %}>Relative</option>
                <option value="friend" {% if profile.emergency_contact_relation == 'friend' %}selected{% endif %}>Friend</option>
                <option value="other" {% if profile.emergency_contact_relation == 'other' %}selected{% endif %}>Other</option>
              </select>
            </div>

            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-success">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                  <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                  <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                </svg>
                Save Changes
              </button>
              <button type="button" class="btn btn-secondary" data-bs-toggle="collapse" data-bs-target="#editContact">
                Cancel
              </button>
            </div>
          </form>
        </div>
      </div>

      <div class="alert alert-warning">
        <strong>Important:</strong> Make sure your emergency contact information is current and accurate. 
        This information will be used to notify your contact in case of emergencies.
      </div>
    </div>

    <!-- Sidebar Info -->
    <div class="col-md-4">
      <div class="card bg-light">
        <div class="card-body">
          <h6 class="card-title fw-bold mb-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="#6c757d" class="me-2" viewBox="0 0 16 16">
              <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393z"/>
            </svg>
            Quick Tips
          </h6>
          <ul class="small text-muted mb-0">
            <li>Keep your emergency contact updated</li>
            <li>Provide mobile number if possible</li>
            <li>Inform your contact about this</li>
            <li>Choose someone you trust</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .form-control, .form-select {
    border-radius: 0.375rem;
  }
  .form-control:focus, .form-select:focus {
    border-color: #6c757d;
    box-shadow: 0 0 0 0.2rem rgba(108, 117, 125, 0.25);
  }
</style>
{% endblock %}
